<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spawn Completo - Brasil Roleplay</title>
    <link rel="icon" type="image/png" href="asset/policia.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-logo">
                <img src="asset/policia.png" alt="Brasil Policia" class="logo">
                <h1>Spawn Policia</h1>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="veiculos">üöó Ve√≠culos</button>
            <button class="tab-btn" data-tab="coordenadas">üìç Coordenadas</button>
        </div>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="üîç Pesquisar...">
        </div>

        <div class="filters" id="filters"></div>

        <div class="result-count">Mostrando resultados...</div>

        <div id="itemsList" class="items-list"></div>
    </main>

    <script>
        // Estado da aplica√ß√£o usando m√≥dulo
        const AppState = (() => {
            const state = {
                vehicles: [],
                coordinates: [],
                currentTab: 'veiculos',
                currentFilter: 'Todos',
                searchTerm: ''
            };

            const FILTERS = ['Todos', 'PCESP', 'PF', 'PMERJ', 'PRF', 'BOPE', 'ROTA', 'EB'];

            return {
                get: (key) => state[key],
                set: (key, value) => state[key] = value,
                getFilters: () => FILTERS
            };
        })();

        // M√≥dulo de carregamento de dados
        const DataLoader = (() => {
            const loadJSON = async (filename) => {
                try {
                    const response = await fetch(filename);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error(`‚ùå Erro ao carregar ${filename}:`, error);
                    return [];
                }
            };

            const init = async () => {
                const [vehicles, coordinates] = await Promise.all([
                    loadJSON('vehicles.json'),
                    loadJSON('coordinates.json')
                ]);
                
                AppState.set('vehicles', vehicles);
                AppState.set('coordinates', coordinates);
                console.log('‚úÖ Dados carregados:', { vehicles: vehicles.length, coordinates: coordinates.length });
            };

            return { init };
        })();

        // M√≥dulo de filtros
        const FilterManager = (() => {
            const container = document.getElementById('filters');

            const render = (tab) => {
                if (tab !== 'veiculos') {
                    container.innerHTML = '';
                    return;
                }

                const filters = AppState.getFilters();
                const currentFilter = AppState.get('currentFilter');
                
                container.innerHTML = filters.map(filter => 
                    `<button class="filter-btn ${filter === currentFilter ? 'active' : ''}" data-filter="${filter}">${filter}</button>`
                ).join('');

                attachEvents();
            };

            const attachEvents = () => {
                container.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', handleFilterClick);
                });
            };

            const handleFilterClick = (e) => {
                const filter = e.target.dataset.filter;
                AppState.set('currentFilter', filter);
                container.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                ItemRenderer.render();
            };

            return { render };
        })();

        // M√≥dulo de renderiza√ß√£o de itens
        const ItemRenderer = (() => {
            const listElement = document.getElementById('itemsList');
            const countElement = document.querySelector('.result-count');

            const escapeHtml = (text) => {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            };

            const getImageUrl = (vehicle) => {
                if (!vehicle.imagem) return 'asset/default-car.png';
                return vehicle.imagem.startsWith('http') ? vehicle.imagem : `asset/vehicles/${vehicle.imagem}`;
            };

            const renderVehicle = (v) => {
                const imageUrl = getImageUrl(v);
                const safeCarro = escapeHtml(v.carro);
                const safeSpawn = escapeHtml(v.spawn);
                const safeGuarnicao = escapeHtml(v.guarnicao);

                return `
                    <div class="item-card">
                        <div class="vehicle-image-container">
                            <img src="${imageUrl}" 
                                 alt="${safeCarro}" 
                                 class="vehicle-image"
                                 onerror="this.src='asset/policia.png'"
                                 loading="lazy">
                        </div>
                        <div class="item-info">
                            <div class="info-group">
                                <span class="item-label">Carro:</span>
                                <span class="item-value">${safeCarro}</span>
                            </div>
                            <div class="info-group">
                                <span class="item-label">Spawn:</span>
                                <span class="item-value">${safeSpawn}</span>
                            </div>
                            <div class="info-group">
                                <span class="item-label">Guarni√ß√£o:</span>
                                <span class="item-value">${safeGuarnicao}</span>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-copy" onclick="ClipboardManager.copySpawn('${safeSpawn}')" title="Copiar spawn">üìã</button>
                        </div>
                    </div>
                `;
            };

            const renderCoordinate = (c) => {
                const safeLocal = escapeHtml(c.local);
                const safeCoord = escapeHtml(c.coordenada);

                return `
                    <div class="item-card">
                        <div class="item-info">
                            <div class="info-group">
                                <span class="item-label">Local:</span>
                                <span class="item-value">${safeLocal}</span>
                            </div>
                            <div class="info-group">
                                <span class="item-label">Coordenada:</span>
                                <span class="item-value">${safeCoord}</span>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-copy" onclick="ClipboardManager.copyCoordinate('${safeCoord}')" title="Copiar coordenada">üìã</button>
                        </div>
                    </div>
                `;
            };

            const filterItems = (items, searchFields) => {
                const search = AppState.get('searchTerm').toLowerCase();
                const filter = AppState.get('currentFilter');
                const tab = AppState.get('currentTab');

                return items.filter(item => {
                    const matchesSearch = searchFields.some(field => 
                        item[field]?.toLowerCase().includes(search)
                    );

                    if (tab === 'veiculos') {
                        const matchesFilter = filter === 'Todos' || item.guarnicao === filter;
                        return matchesSearch && matchesFilter;
                    }

                    return matchesSearch;
                });
            };

            const render = () => {
                const tab = AppState.get('currentTab');
                
                if (tab === 'veiculos') {
                    const vehicles = AppState.get('vehicles');
                    const filtered = filterItems(vehicles, ['carro', 'spawn', 'guarnicao']);
                    
                    countElement.textContent = `Mostrando ${filtered.length} de ${vehicles.length} ve√≠culos`;
                    listElement.innerHTML = filtered.map(renderVehicle).join('');
                } else {
                    const coordinates = AppState.get('coordinates');
                    const filtered = filterItems(coordinates, ['local', 'coordenada']);
                    
                    countElement.textContent = `Mostrando ${filtered.length} de ${coordinates.length} locais`;
                    listElement.innerHTML = filtered.map(renderCoordinate).join('');
                }
            };

            return { render };
        })();

        // M√≥dulo de gerenciamento de clipboard
        const ClipboardManager = (() => {
            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (error) {
                    console.error('Erro ao copiar:', error);
                    return false;
                }
            };

            const copySpawn = async (spawn) => {
                const commandText = `car ${spawn}`;
                const success = await copyToClipboard(commandText);
                if (success) NotificationManager.show(`‚úÖ Copiado: ${commandText}`);
            };

            const copyCoordinate = async (coord) => {
                const success = await copyToClipboard(coord);
                if (success) NotificationManager.show(`‚úÖ Coordenada copiada: ${coord}`);
            };

            return { copySpawn, copyCoordinate };
        })();

        // M√≥dulo de notifica√ß√µes
        const NotificationManager = (() => {
            const show = (message) => {
                const notif = document.createElement('div');
                notif.className = 'notification';
                notif.textContent = message;
                document.body.appendChild(notif);
                
                requestAnimationFrame(() => {
                    notif.classList.add('show');
                });

                setTimeout(() => {
                    notif.classList.remove('show');
                    setTimeout(() => notif.remove(), 300);
                }, 2000);
            };

            return { show };
        })();

        // M√≥dulo de gerenciamento de eventos
        const EventManager = (() => {
            const init = () => {
                // Search input
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    AppState.set('searchTerm', e.target.value);
                    ItemRenderer.render();
                });

                // Tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', handleTabChange);
                });
            };

            const handleTabChange = (e) => {
                const tab = e.target.dataset.tab;
                
                // Update UI
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                // Update state
                AppState.set('currentTab', tab);
                AppState.set('currentFilter', 'Todos');
                AppState.set('searchTerm', '');
                document.getElementById('searchInput').value = '';
                
                // Re-render
                FilterManager.render(tab);
                ItemRenderer.render();
            };

            return { init };
        })();

        // Inicializa√ß√£o da aplica√ß√£o
        (async () => {
            try {
                await DataLoader.init();
                FilterManager.render('veiculos');
                ItemRenderer.render();
                EventManager.init();
                console.log('üí° Edite vehicles.json e coordinates.json para alterar os dados');
                console.log('üì∏ Adicione o campo "imagem" nos ve√≠culos para exibir fotos');
            } catch (error) {
                console.error('‚ùå Erro ao inicializar aplica√ß√£o:', error);
                NotificationManager.show('‚ùå Erro ao carregar aplica√ß√£o');
            }
        })();
    </script>
</body>
</html>